import { type NextPage } from "next";
import Head from "next/head";
import { api } from "../utils/api";
import Image from "next/image";
import { useState } from "react";
import { useRouter } from "next/router";
import useAuth from "../hooks/useAuth";

const Home: NextPage = () => {
  const { data: ranking } = api.ranking.get.useQuery();
  const sum = ranking?.reduce((prev, curr) => prev + curr.score, 0);

  const router = useRouter();
  const [nickname, setNickname] = useState("");

  const { generateUser } = useAuth();
  const handleSubmit = () => {
    const refinedNickname = nickname.trim();
    generateUser(refinedNickname.length === 0 ? "익명의 눈" : refinedNickname);
    void router.push("/questions");
  };

  return (
    <>
      <Head>
        <title>NooN</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main>
        
        <div className="area" >
          <ul className="circles">
            <li></li>
            <li></li>
            <li></li>
          </ul>
          <div className="backgroundFig1">
            <Image
                  priority
                  src="/fig1.png"
                  alt=""
                  width={247}
                  height={187}
            />
          </div>
          <div className="backgroundFig2">
            <Image
                  priority
                  src="/fig2.png"
                  alt=""
                  width={197}
                  height={211}
            />
          </div>
          <div className="backgroundImg1">
            <Image
                  priority
                  src="/main1.png"
                  alt=""
                  width={323}
                  height={503}
            />
          </div>
          <div className="backgroundImg2">
            <Image
                  priority
                  src="/main2.png"
                  alt=""
                  width={312}
                  height={328}
            />
          </div>
          <div className="backgroundImg3">
            <Image
                  priority
                  src="/main3.png"
                  alt=""
                  width={280}
                  height={298}
            />
          </div>

          <div className="middle">
            <div className="ranking">
              <ul>
                {ranking?.slice(0, 4).map((user) => (
                  <li key={user.userUuid}>
                    {user.rank}등 {user.nickname} {user.score}벌
                  </li>
                ))}
              </ul>
            </div>
            <div className="impact">
              <p>총 {sum ?? "..."}벌을 읽었어요!</p>
            </div>
            <div className="imgAlign">
              <Image
                priority
                src="/logo.png"
                alt="NooN 로고"
                width={382}
                height={122}
              />
            </div>

            <div className="subTitle">
              <Image
                priority
                src="/sublogo.png"
                alt="for Fashion"
                width={207}
                height={99}
              />
            </div>
            <p className="p1">패션을 들려주는 새로운 눈</p>
          </div>
          <div className="bottom">
            <form 
                onSubmit={(e) => {
                  e.preventDefault();
                  handleSubmit();
                }}
              >
                <input
                  id="nickname"
                  name="nickname"
                  placeholder="닉네임을 입력하세요"
                  value={nickname}
                  onChange={(e) => {
                    setNickname(e.target.value);
                  }}
                />
              <p className="p2">더 많은 사람들이 선택한 대체텍스트를 찾아 보세요!</p>
              <button>시작하기</button>
            </form>
          </div>
        </div >

      </main>
      <style jsx>{`
          body {
            background-color: white;
            color: white;
            font-family: "SCoreDream";
            font-style: normal;
          }
          .middle {
            text-align: center;
            color: #FFFFFF;
            mix-blend-mode: difference;
            will-change: opacity;
          }
          .ranking {
            margin-bottom: 50px;
          }
          .impact {
            font-weight: 600;
            font-size: 30px;
            line-height: 36px;
            margin: 20px;
          }
          .imgAlign {
            display: flex;
            justify-content: center;
            mix-blend-mode: difference;
          }
          .subTitle {
            display: flex;
            justify-content: center;
            margin: 10px;
          }
          .p1{
            font-weight: 300;
            font-size: 20px;
            line-height: 24px;
            margin: 40px;
          }
          .p2{
            font-weight: 300;
            font-size: 15px;
            line-height: 18px;
            margin: 15px;
          }
          button{
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;

            font-weight: 700;
            font-size: 30px;
            line-height: 38px;

            background: #000000;
            color: #FFFFFF;
            padding: 25px 140px;
            display: inline-block;
            width: auto;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.5s;
          }
          .bottom {
            color: black;
            justify-content: center;
            text-align: center;
          }
          input {
            font-weight: 300;
            font-size: 20px;
            line-height: 24px;
            background: transparent;
            border-bottom: 1px solid;
            text-align: center;
            color: #000000;
          }

          /** background css */
          .backgroundFig1{
            position: absolute;
            right: 28px;
            top: 69px;
            mix-blend-mode: difference;
          }
          .backgroundFig2{
            position: absolute;
            left: 200px;
            bottom: 69px;
            mix-blend-mode: difference;
          }
          .backgroundImg1{
            position: absolute;
            left: 0px;
            top: 0px;
          }
          .backgroundImg2{
            position: absolute;
            right: 140px;
            top: 15px;
          }
          .backgroundImg3{
            position: absolute;
            left: 222px;
            bottom: 0px;
          }
        `}
      </style>
    </>
  );
};

export default Home;
